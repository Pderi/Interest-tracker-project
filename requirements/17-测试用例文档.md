# 测试用例文档（Test Cases）

## 1. 文档信息
- 文档名称：测试用例文档
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：测试团队
- 状态：草稿

## 2. 用例编写规范
- 模板字段：用例编号、标题、前置条件、步骤、预期结果、优先级（H/M/L）、类型（正向/异常/边界）、关联需求（FR/接口）、结果。
- 覆盖要求：Must 需求 100%；Should ≥90%；鉴权/越权、上传、AI 兜底必测。
- 数据：使用测试账号（用户/管理员）、合法与非法文件、重复 tmdb_id/lastfm_id、跨时间段数据。

## 3. 用例列表（示例摘录）

### 3.1 认证/鉴权
| 编号 | 标题 | 前置 | 步骤 | 预期 | 优先级 | 类型 | 关联 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| TC-AUTH-001 | 注册成功 | 无 | 调用 /auth/register | 返回 userId，存库 | H | 正向 | FR-01 |
| TC-AUTH-002 | 登录成功 | 已注册 | /auth/login | 返回 token | H | 正向 | FR-01 |
| TC-AUTH-003 | 未登录访问受限接口 | 无 | GET /api/photos | 返回 401 | H | 异常 | 安全 |
| TC-AUTH-004 | 越权访问他人资源 | A 用户登录 | 访问 B 的资源 | 返回 403 | H | 异常 | 安全 |

### 3.2 摄影（上传/EXIF/AI）
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| TC-PHOTO-001 | 上传合法 JPG | 登录 | POST /photos (JPG<10MB) | 返回 id/url/EXIF/标签(可空) | H | 正向 | FR-02 |
| TC-PHOTO-002 | 文件类型非法 | 登录 | POST /photos (txt) | 4101，提示类型限制 | H | 异常 | 安全 |
| TC-PHOTO-003 | 文件超限 | 登录 | POST /photos (11MB) | 4101，提示大小限制 | H | 异常 | 安全 |
| TC-PHOTO-004 | EXIF 解析 | 登录 | 上传带 EXIF | 返回 shoot_time/设备/GPS | M | 正向 | FR-02 |
| TC-PHOTO-005 | AI 标签成功 | 登录，AI on | /photos + 自动标签 | 返回 3-5 标签 | H | 正向 | FR-06 |
| TC-PHOTO-006 | AI 标签失败兜底 | 关闭外部/打桩失败 | /photos | 返回失败提示，可手动 | H | 异常 | FR-06 |

### 3.3 影视（TMDB 搜索/创建）
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| TC-MOV-001 | TMDB 搜索成功 | 登录 | GET /movies/search | 返回结果列表 | H | 正向 | FR-03 |
| TC-MOV-002 | TMDB 搜索失败降级 | TMDB 失败/Mock | /movies/search | 返回错误码，提示手动 | H | 异常 | FR-03 |
| TC-MOV-003 | 创建带 tmdbId | 登录 | POST /movies | 成功，tmdbId 入库 | H | 正向 | FR-03 |
| TC-MOV-004 | tmdbId 重复 | 登录 | 重复创建同 tmdbId | 拒绝/去重 | M | 异常 | 数据 |

### 3.4 音乐（Last.fm 搜索/创建）
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| TC-MUS-001 | Last.fm 搜索成功 | 登录 | GET /musics/search | 返回结果 | H | 正向 | FR-04 |
| TC-MUS-002 | 搜索失败降级 | Last.fm 失败/Mock | /musics/search | 错误码+提示手动 | H | 异常 | FR-04 |
| TC-MUS-003 | 创建带 lastfmId | 登录 | POST /musics | 成功，lastfmId 入库 | H | 正向 | FR-04 |
| TC-MUS-004 | lastfmId 重复 | 登录 | 重复创建 | 拒绝/去重 | M | 异常 | 数据 |

### 3.5 球赛（简版）
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| TC-MAT-001 | 创建比赛 | 登录 | POST /matches | 成功，必填校验 | H | 正向 | FR-05 |
| TC-MAT-002 | 时间必填校验 | 登录 | 不填时间 | 4001，提示必填 | H | 异常 | 校验 |

### 3.6 时间线/统计
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| TC-TIME-001 | 时间线过滤 | 有数据 | GET /timeline?type=all&time=range | 结果按时间/过滤正确 | H | 正向 | FR-08 |
| TC-STAT-001 | 基础统计 | 有数据 | GET /stats/summary | 数量/占比正确 | H | 正向 | FR-09 |

### 3.7 推荐/总结（可选）
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| TC-REC-001 | 影视推荐 | 有历史 | GET /recommend/movies | 返回列表/理由 | M | 正向 | 推荐 |
| TC-SUM-001 | 月度总结 | 有月度数据 | GET /summary/monthly | 返回统计与文案 | M | 正向 | 总结 |

### 3.8 安全/权限
| 编号 | 标题 | 前置 | 步骤 | 预期 | P | 类型 | 关联 |
| TC-SEC-001 | 未登录访问 | 无 | 访问受限接口 | 401 | H | 异常 | 安全 |
| TC-SEC-002 | 越权访问 | A 登录 | 访问 B 数据 | 403 | H | 异常 | 安全 |
| TC-SEC-003 | 上传类型/大小校验 | 登录 | 非法文件 | 4101 | H | 异常 | 安全 |
| TC-SEC-004 | 日志脱敏抽查 | - | 触发错误 | 日志无敏感信息 | M | 检查 | 安全 |

### 3.9 性能（概要用例）
| 编号 | 标题 | 场景 | 目标 | 工具 | 关联 |
| TC-PERF-001 | 上传压测 | 10MB 文件，QPS 20 | P95<2s | JMeter/k6 | 性能 |
| TC-PERF-002 | 查询压测 | 列表/时间线 QPS 50 | P95<800ms | JMeter/k6 | 性能 |

## 4. 结果记录
- 执行结果：通过/失败/阻塞
- 缺陷：编号、严重级别、状态
- 备注：数据、环境、日志

## 5. 变更记录
- v1.0.0：首版示例（MVP）

