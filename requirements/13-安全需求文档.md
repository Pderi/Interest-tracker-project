# 安全需求文档（Security Requirements）

## 1. 文档信息
- 文档名称：安全需求文档
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：安全/技术团队
- 状态：草稿

## 2. 目标与范围
- 目标：确保 MVP 阶段的认证、鉴权、数据安全、通信安全与合规要求得到满足。
- 范围：后端 API、数据存储、外部调用、配置管理。

## 3. 认证与鉴权
- 认证：JWT/Token（登录/注册开放，其余需 Authorization: Bearer）
- 鉴权：简版 RBAC（用户/管理员），后端校验角色；普通用户仅访问自身数据
- 越权：所有业务查询/更新必须按 user_id 过滤；管理员接口需明确标记并校验
- Token：有效期可配置；过期 401；黑名单/登出失效（可选）

## 4. 通信安全
- 生产必须 HTTPS；开发可 HTTP
- 避免明文传输敏感信息；上传使用 HTTPS

## 5. 数据安全
- 密码加密存储（不可逆）；不返回密码/敏感字段
- 配置脱敏：API Key/密钥不入库，使用环境变量，日志不打印密钥
- 数据分级：密码/Token/密钥为高敏；图片/位置信息为敏感；最小化收集与曝光
- 用户隔离：所有业务表按 user_id 过滤；管理员访问需审计
- 软删：deleted 默认过滤
- 数据导出/删除：提供用户数据导出/删除的设计占位（合规）

## 6. 输入与上传校验
- 参数校验：后端对必填、长度、枚举、范围进行校验
- 文件上传：限制类型（JPG/PNG）、大小（≤10MB）；校验失败返回明确错误
- 防注入：使用参数化/ORM；禁止拼接 SQL

## 7. 访问与速率控制（占位）
- 基础限流：可按 IP/用户设置简单限流，防刷（生产按需开启）
- 防重放：Token 校验；上传无签名暂不要求

## 8. 日志与审计
- 日志脱敏：不记录密码/Token/密钥；错误栈过滤敏感信息
- 审计范围（占位）：管理员操作（删除/修改他人数据）、登录失败高频、权限变更
- 追踪：请求 ID/用户 ID 关联，便于定位安全事件

## 9. 外部服务与合规
- 遵守 TMDB/Last.fm/AI API 使用条款与配额
- 隐私合规：最小化收集，告知用户数据用途；支持删除/导出占位
- AI：默认免费方案；付费/大模型需成本控制与调用限额

## 10. 安全测试与验收
- 用例：登录/鉴权/越权/参数校验/上传校验；基础限流（如开启）
- 通过标准：越权全部拒绝；敏感信息不泄露；上传校验生效

## 11. 威胁与对策（简版 STRIDE）
- 伪造/越权：JWT 校验、RBAC、user_id 过滤
- 信息泄露：日志脱敏、最小返回字段、HTTPS
- 拒绝服务：限流占位、外部调用超时、线程池/连接池保护
- 重放：Token 过期控制；关键接口鉴权
- 依赖风险：第三方配额/可用性监控，失败降级

## 11. 变更与版本
- 安全策略变更需评审；版本按 vX.Y.Z 记录

