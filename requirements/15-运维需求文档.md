# 运维需求文档（Operations Requirements）

## 1. 文档信息
- 文档名称：运维需求文档
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：运维/技术团队
- 状态：草稿

## 2. 目标与范围
- 目标：定义 MVP 阶段的部署、监控、日志、备份、发布与应急要求，支撑稳定交付与运维。
- 范围：后端服务、数据库、缓存（可选）、对象存储（可选），外部依赖监控。

## 3. 部署与发布
- 形态：单节点部署（MVP）；预留容器化（Dockerfile）与多环境配置
- 环境：dev / prod（可选 stage）
- 配置：环境变量注入（DB/Redis/API Keys/OSS/AI）；配置分环境隔离
- 发布：滚动/停机发布均可（单节点）；发布前备份数据库；发布后冒烟
- 构建：Maven 构建；建议产物版本化
- 变更冻结：重大节假日/高峰前冻结发布

## 4. 监控与告警
- 指标：QPS、响应时间、错误率、JVM（CPU/内存/GC）、DB 连接池、外部依赖失败率
- 日志：访问/错误/慢查（可选），建议 JSON 便于采集；日志脱敏
- 告警（占位）：健康检查失败、错误率/响应时间超阈值、外部依赖异常
- 外部依赖：TMDB/Last.fm/AI 调用失败率、超时监控

## 5. 日志与追踪
- 日志级别：prod 默认 INFO；故障排查可临时 DEBUG
- 追踪：请求 ID/链路 ID（占位，可用拦截器），便于问题定位
- 脱敏：不记录密码/Token/敏感配置

## 6. 备份与恢复
- 数据库：日级备份（全量/增量策略后续明确）；定期恢复演练（占位）
- 对象存储：原图/封面单副本或冗余存储；删除/覆盖需审慎
- 配置：重要配置备份（环境变量/密钥安全存储，不入库）
- 备份校验：备份文件可用性校验（占位）

## 7. 容灾与高可用（MVP 占位）
- 单区单活，无多活要求；若需多活需新增设计（数据同步/切换）
- 服务故障：可快速重启；必要时回滚版本
- 故障演练：重启/配置回滚演练（占位）

## 8. 安全与合规（运维侧）
- HTTPS（生产）；防越权；最小权限原则（DB/Redis/OSS 账号权限收敛）
- 密钥管理：API Key/密钥使用环境变量；避免写入代码仓库
- 审计：关键运维操作记录（占位）

## 9. 发布与变更管理
- 发布流程：代码合入 → 构建 → 部署 → 冒烟 → 监控观察
- 变更记录：版本、时间、变更内容、回滚方案
- 回滚：保留上一个稳定版本，支持快速回退
- 冒烟用例（占位）：健康检查、登录、上传、列表查询、搜索、AI 标签（可打桩）

## 10. 应急预案（基础）
- 外部依赖异常：超时/重试/降级（手动输入兜底），必要时关闭相关开关
- AI 成本/配额异常：默认免费；付费 AI 关闭；必要时限流
- 数据库异常：只读模式/限流；优先恢复服务读能力
- 配置误改：回滚上一版本配置；重启服务
- 磁盘告警：清理日志/临时文件；扩容存储

## 11. 验收
- 部署可重复，配置分环境生效
- 健康检查与基本监控可用
- 备份执行并可验证（占位）
- 日志可查询，脱敏有效

## 12. 版本
- v1.0.0：MVP 运维要求首版

