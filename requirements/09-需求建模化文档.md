# 需求建模化文档

## 1. 文档信息
- 文档名称：需求建模化文档
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：产品/架构团队
- 状态：草稿

## 2. 目的与范围
- 目的：以图示形式呈现核心需求的上下文、用例、数据流、时序与部署，便于跨团队快速对齐。
- 范围：MVP 范围内的核心功能（多兴趣记录、免费 AI 标签、TMDB/Last.fm、时间线/基础统计、简版 RBAC）。

---

## 3. 上下文图（Context Diagram，ASCII）
```
               ┌─────────────────┐
               │     用户(User)   │
               └───▲─────────▲───┘
                   │         │
         记录/浏览/回顾   登录/鉴权
                   │         │
           ┌───────┴─────────┴───────┐
           │   Interest Tracker 系统  │
           └───┬───────────┬────────┘
               │           │
     影视数据查询/海报   音乐数据查询/封面
               │           │
           ┌───▼───┐   ┌───▼───┐
           │ TMDB  │   │Last.fm│
           └───────┘   └───────┘
               │           │
          AI 标签/描述     AI 标签/描述
               │           │
      ┌────────▼────────┐
      │ HF / Gemini (AI) │  （免费优先，OpenAI 备选）
      └─────────────────┘
```

---

## 4. 用例图（Use Case，ASCII）
```
      用户
       |
       |-------------------------------------------|
       |                                           |
  登录/注册                                   记录/整理/回顾
       |                                           |
       |                        ┌────────────────────┐
       |                        │ 记录照片（上传/EXIF/AI标签）│
       |                        ├────────────────────┤
       |                        │ 记录影视（搜索TMDB/手动） │
       |                        ├────────────────────┤
       |                        │ 记录音乐（搜索Last.fm/手动）│
       |                        ├────────────────────┤
       |                        │ 记录球赛（手动）          │
       |                        ├────────────────────┤
       |                        │ 自动标签（照片/影视/音乐） │
       |                        ├────────────────────┤
       |                        │ 列表/时间线/统计回顾      │
       |                        └────────────────────┘
       |
   管理员（继承用户用例，且可管理全量数据）
```

---

## 5. 时序图（关键流程，文字描述 + ASCII）

### 5.1 上传照片并自动标签
```
用户 -> 前端: 选择文件/上传
前端 -> 后端: /api/photo (文件) [Multipart]
后端 -> 存储: 保存文件/缩略图
后端 -> EXIF解析: 提取时间/设备/GPS
后端 -> AI Client (HF/Gemini): 请求生成标签（默认开启）
AI Client -> 后端: 返回标签（或失败）
后端: 组装记录（含标签）入库
后端 -> 前端: 返回成功 + 标签/EXIF
前端: 展示标签，可编辑
```

### 5.2 搜索影视并创建
```
用户 -> 前端: 输入关键词
前端 -> 后端: /api/movie/search (TMDB)
后端 -> TMDB: 搜索接口
TMDB -> 后端: 返回结果
后端 -> 前端: 返回结果列表
用户 -> 前端: 选择结果
前端 -> 后端: /api/movie (创建)
后端: 入库，回填 poster_url / tmdb_id
后端 -> 前端: 返回成功
```

### 5.3 时间线/列表回顾
```
用户 -> 前端: 选择过滤/排序/时间线视图
前端 -> 后端: /api/timeline 或 /api/{domain}/list
后端 -> MySQL: 查询 + 过滤 + 排序
后端 -> 前端: 返回列表/时间线数据
前端: 渲染时间线/列表
```

---

## 6. 数据流图（DFD，Level 0，ASCII）
```
        用户
         │  上传/搜索/浏览
         ▼
┌───────────────────────┐
│   Interest Tracker    │
│  ───────────────────  │
│ 1) 上传/创建          │
│ 2) AI 标签/解析        │
│ 3) 存储与查询          │
│ 4) 回顾与统计          │
└────────┬─────┬────────┘
         │     │
   ┌─────▼─┐ ┌─▼──────────┐
   │MySQL  │ │Redis*       │  (*缓存搜索/AI 结果，可选)
   └───────┘ └────────────┘
         │
   ┌─────▼─────┐
   │存储(本地/云)│  照片/封面
   └───────────┘
         │
   ┌─────▼──────┐   ┌───────────┐   ┌────────┐
   │ TMDB       │   │ Last.fm   │   │ HF/GMN │
   │ (影视数据) │   │ (音乐数据) │   │ (AI)   │
   └───────────┘   └───────────┘   └────────┘
```

---

## 7. 部署图（Deployment，MVP，ASCII）
```
┌──────────────────────────────┐
│        用户浏览器            │
└───────────▲──────────────────┘
            │ HTTPS
┌───────────┴──────────────────┐
│     Nginx/反向代理 (可选)     │
└───────────▲──────────────────┘
            │ HTTP
┌───────────┴──────────────────┐
│ Spring Boot 应用（单节点）     │
│ - Controller/Service/Mapper   │
│ - Clients: TMDB/Last.fm/HF/GMN│
│ - Swagger/Actuator            │
└───────┬─────────┬────────────┘
        │         │
   ┌────▼───┐  ┌──▼──────┐
   │ MySQL  │  │ Redis*  │ (*可选)
   └───────┘  └─────────┘
        │
   ┌────▼─────────┐
   │ 对象存储*    │ (*本地/MinIO/OSS，MVP 可本地)
   └──────────────┘
        │
   ┌────▼────────┐   ┌───────────┐   ┌────────┐
   │ TMDB        │   │ Last.fm   │   │ HF/GMN │
   └─────────────┘   └───────────┘   └────────┘
```

---

## 8. 说明与约束
- 图示为 MVP 形态，突出免费 AI 优先与核心数据流；后续可扩展多节点/容器化/CI-CD。
- Redis/对象存储在 MVP 可选，视实际需要开启；付费 AI（OpenAI）默认关闭不在图中显示。
- 若需正式 UML 图，可后续输出 PlantUML/Draw.io 版本。文件可在 `requirements/diagrams/` 追加源文件（暂未生成）。

---

## 9. 后续工作
- 补充正式图（PlantUML/Draw.io）并存档
- 若有新功能（推荐/社交/会员）或新数据源，更新上下文/DFD/部署/时序
- 与 IRD/DDD 对齐字段与接口，确保一致性


