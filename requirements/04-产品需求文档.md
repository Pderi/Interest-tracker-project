# 产品需求文档（PRD）

## 1. 文档信息
- 文档名称：产品需求文档（PRD）
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：产品团队
- 状态：草稿

## 2. 文档目的
- 将业务需求（BRD）转化为可执行的产品功能需求，指导设计、开发、测试与验收。
- 明确功能范围、优先级、流程、交互、数据与验收标准，形成需求基线。

## 3. 背景与目标
- 背景：多兴趣（摄影/影视/音乐/球赛）记录分散，缺少统一管理与自动化整理、回顾体验。
- 目标：提升记录效率与完成率、提供基础回顾与分析、为后续推荐与商业化打基础。
- 关联文档：《01-需求调研文档》《02-需求分析文档》《03-业务需求规格说明》

## 4. 范围与版本规划
### 4.1 本期（MVP）范围
- 多兴趣统一记录：摄影、影视、音乐（球赛简版手动）
- 自动化：照片自动标签（免费 AI 优先），影视/音乐标签生成（免费 AI 优先）
- 数据源：TMDB（影视）、Last.fm（音乐），本地照片 EXIF 解析
- 回顾与基础分析：时间线/列表、基础统计卡片（数量/时间/占比）
- 账号与权限：注册/登录，简版 RBAC（用户/管理员）
- 日志与健康检查：关键接口日志、健康检查

### 4.2 非本期范围
- 深度社交（关注/评论/点赞）、支付/会员、高级推荐、复杂可视化大屏、原生 App

### 4.3 版本里程碑（占位）
- M1（MVP）：Must 需求交付
- M2（MVP+）：补充 Should 需求（球赛简版、基础统计、影视/音乐标签）
- M3：后续优化与扩展

## 5. 用户与场景
- 角色：轻度用户（轻记+回顾）、中度用户（标签/检索/推荐）、重度用户（批量管理/导出/分析）
- 核心场景：
  - 记录：上传照片，新增观影/听歌/球赛记录；第三方搜索创建（影视/音乐）
  - 整理：自动标签（免费 AI 优先），手动编辑；过滤、排序
  - 回顾：时间线/列表；基础统计卡片
  - 管理：登录/登出，基础权限

## 6. 功能需求（FR）
优先级：Must/Should/Could/Won’t（与 BRD 对齐）

### FR-01 用户注册/登录（Must）
- 功能：邮箱/手机号+密码注册、登录、登出；密码校验、错误提示；Token 有效期可配
- 验收：能注册/登录/登出；异常提示清晰；Token 正常刷新/过期处理

### FR-02 摄影记录（Must）
- 功能：上传 JPG/PNG；读取 EXIF（时间/设备/GPS）；详情/列表/排序；标签字段
- 规则：单文件≤10MB；支持 EXIF 解析；支持标签多选/编辑
- 验收：EXIF 解析成功率≥90%；分页/排序准确；标签可存取

### FR-03 影视记录（Must）
- 功能：TMDB 搜索并创建；手动补充；状态（想看/在看/已看/弃剧）、评分、标签
- 规则：搜索结果缓存；失败可手动创建；评分 0.5 颗粒度
- 验收：搜索可用；创建/编辑成功；状态/评分/标签可存取

### FR-04 音乐记录（Must）
- 功能：Last.fm 搜索并创建；手动补充；标签
- 规则：搜索结果缓存；失败可手动创建
- 验收：搜索可用；创建/编辑成功；标签可存取

### FR-05 球赛记录（Should）
- 功能：手动录入对阵/时间/比分/类型；列表/详情
- 规则：时间必填；比分可空；类型（联赛/杯赛/友谊赛）
- 验收：录入成功；可查询与排序

### FR-06 自动标签（照片）（Must）
- 功能：调用免费 AI（Hugging Face/Gemini）生成 3-5 标签；可回填并编辑；失败可重试/手动
- 规则：默认免费 API，失败降级手动；结果缓存 24h；可关闭开关
- 验收：成功率（返回可用标签）≥90%；失败有兜底提示

### FR-07 自动标签（影视/音乐）（Should）
- 功能：基于影片/歌曲信息，调用免费 AI 生成 3-5 标签；可编辑
- 规则：结果缓存；可重试；可关闭开关
- 验收：有可用标签；失败可手动补充

### FR-08 时间线/列表回顾（Must）
- 功能：按时间/类型/标签过滤；时间线/列表视图；排序（时间/评分）
- 规则：默认按时间倒序；过滤可组合
- 验收：过滤准确；排序正确

### FR-09 基础统计卡片（Should）
- 功能：记录总数；按周/月计数；按类型占比
- 规则：统计口径与数据库一致；定时/实时更新方案（二选一，MVP 可简版实时查询）
- 验收：统计结果与样本核对一致

### FR-10 权限/角色（Must）
- 功能：用户/管理员；鉴权与越权校验
- 规则：用户只能操作自身数据；管理员可管理全量
- 验收：越权用例被拒绝；鉴权生效

### FR-11 日志与健康检查（Must）
- 功能：关键接口访问/错误日志；健康检查接口
- 规则：不记录敏感信息；健康检查返回 200
- 验收：日志可追溯；健康检查正常

## 7. 非功能需求（NFR，摘要，研发需细化）
- 性能：核心接口 P95 < 800ms（MVP 数据量）；后续优化 < 500ms
- 可用性：SLA 99.5%（单区单活），允许维护窗口
- 安全：HTTPS；鉴权/越权；基础限流；敏感配置不落库
- 隐私：图片/位置信息仅用户可见；数据导出/删除占位设计
- 监控/日志：接口/错误日志；健康检查；可选简易告警

## 8. 交互与体验（摘要，详见设计/原型）
- 信息架构：多兴趣入口统一；记录/搜索/列表/详情/时间线
- 关键流程：上传照片 → 自动标签 → 编辑 → 保存；TMDB/Last.fm 搜索 → 选择 → 创建
- 状态与反馈：加载/空态/错误/重试；AI 调用中的提示与失败兜底
- 可用性：表单校验清晰；过滤/搜索可组合；移动端适配（基础响应式）

## 9. 数据与接口（概要）
- 数据字段（示例）：
  - 照片：id, user_id, title, tags, exif(time, device, gps), file_url, thumb_url, created_at
  - 影视：id, user_id, title, tmdb_id, type, status, rating, tags, poster_url, created_at
  - 音乐：id, user_id, title, artist, album, lastfm_id, tags, cover_url, created_at
  - 球赛：id, user_id, home_team, away_team, match_time, score, match_type, created_at
- 接口（示例，详细见 IRD）：
  - /api/auth/register, /api/auth/login
  - /api/photo (CRUD), /api/photo/ai-tags
  - /api/movie (CRUD+search), /api/music (CRUD+search)
  - /api/match (CRUD)
  - /api/timeline, /api/stats/summary
  - /api/health
- 错误码：统一使用 CommonResult，详见 IRD/错误码表

## 10. 依赖与开关
- 外部：TMDB、Last.fm、Hugging Face/Gemini（免费优先），OpenAI（备选关闭）
- 存储：对象存储（本地/OSS/MinIO）；MySQL；Redis 缓存
- 开关：AI 功能开关（全局/用户级，后端配置）；付费 AI 默认关闭

## 11. 验收标准（产品视角）
- Must 需求用例通过率 100%；Should ≥90%
- AI 标签（照片）成功率≥90%；失败兜底可用
- 搜索/创建：TMDB/Last.fm 可用；失败可手动
- 过滤/排序准确；统计结果与样本核对一致
- 越权用例被拒绝；健康检查可用；关键接口无高频错误

## 12. 追溯与变更
- 追溯：需求编号与 BRD/FR/测试用例映射
- 变更：记录原因、影响范围、优先级调整；PM/Tech/QA 评审；版本号递增

## 13. 风险与对策
- 配额/成本：免费 API 优先；缓存与降级；付费 AI 默认关
- 合规/隐私：最小化收集；加密存储；导出/删除能力（设计占位）；遵守第三方条款
- 进度：Must/Should 分层；范围控制；里程碑拆分

## 14. 术语
- TMDB/Last.fm：第三方影视/音乐数据源
- HF/Gemini：免费 AI 提供方
- RBAC：基于角色的访问控制
- P95：95 分位响应时间


