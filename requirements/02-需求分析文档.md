# 需求分析文档

## 1. 文档信息
- 文档名称：需求分析文档
- 版本号：v1.0.0
- 创建日期：2025-12-09
- 最后更新：2025-12-09
- 作者：产品团队
- 状态：草稿

## 2. 文档目的
- 汇总并分解需求来源，明确范围、优先级、依赖与约束
- 为 BRD/PRD、架构设计与测试制定可追溯的需求基线

## 3. 需求来源
- 市场/竞品调研：《01-需求调研文档》
- 业务访谈：内部访谈（产品/运营/数据）、潜在用户访谈（待补访谈记录）
- 数据分析：暂无历史数据，后续依据 MVP 埋点补充
- 技术可行性：后端/AI/数据团队评审
- 法务与合规：个人信息保护、第三方 API 使用条款

## 4. 需求范围
### 4.1 本期范围（MVP）
- 多兴趣统一记录：摄影、影视、音乐、球赛的创建/查看/列表
- 自动化辅助：照片自动标签（免费 AI 优先）、影视/音乐标签生成（免费 AI 优先）
- 数据来源集成：TMDB（影视）、Last.fm（音乐），本地照片 EXIF 解析
- 基础回顾：时间线/列表展示，简版统计卡片（按数量/时间）
- 账号与鉴权：基础用户体系（登录/注册），简单 RBAC（用户/管理员）
- 日志与基础监控：关键接口日志，基础监控/告警（后端）

### 4.2 非本期范围（暂不做）
- 深度社交：关注、评论、点赞、广场
- 支付/会员：高级存储、AI 高级额度
- 复杂推荐：全域协同过滤 + 深度个性化
- 复杂数据可视化：高级仪表盘、可配置大屏
- 移动端原生 App：仅保留接口兼容性考虑

## 5. 需求分类与优先级
优先级采用 MoSCoW：
- **Must**：MVP 必须交付
- **Should**：重要但可延后到 MVP+ 或下个里程碑
- **Could**：可选增强
- **Won’t**：本期不做

| 编号 | 需求 | 分类 | 优先级 | 说明 |
| --- | --- | --- | --- | --- |
| R1 | 用户注册/登录 | 功能 | Must | 账号体系基础 |
| R2 | 摄影记录：上传、查看、列表 | 功能 | Must | 含 EXIF 解析 |
| R3 | 影视记录：新增、查看、列表 | 功能 | Must | 依赖 TMDB |
| R4 | 音乐记录：新增、查看、列表 | 功能 | Must | 依赖 Last.fm |
| R5 | 球赛记录：新增、查看、列表 | 功能 | Should | 可简版，仅手动录入 |
| R6 | 自动标签（照片） | 功能/AI | Must | 免费 AI 优先（Hugging Face/Gemini） |
| R7 | 自动标签（影视/音乐） | 功能/AI | Should | 免费 AI 优先 |
| R8 | 基础统计卡片 | 功能 | Should | 按数量/时间维度 |
| R9 | 时间线/列表回顾 | 功能 | Must | 基础查询/排序 |
| R10 | 权限/角色（用户/管理员） | 非功能/安全 | Must | 简版 RBAC |
| R11 | 日志与监控 | 非功能/运维 | Must | 关键接口日志、基础监控 |
| R12 | 性能目标（单接口 P95 < 500ms@1k QPS 预期） | 非功能/性能 | Should | MVP 低并发可放宽 |
| R13 | 可用性（SLA 99.5% MVP 阶段） | 非功能/可用性 | Should | 以单节点为主，简易容灾 |
| R14 | 数据导出（CSV/Excel） | 功能 | Could | 后续 |
| R15 | 年度报告/回顾 | 功能 | Won’t | 本期不做，留设计占位 |

## 6. 需求分解（Must/Should）
### R1 用户注册/登录（Must）
- 描述：手机号/邮箱+密码注册、登录；基础校验与错误提示
- 验收：能注册/登录/登出；失败提示清晰；Token 有效期可配置

### R2 摄影记录（Must）
- 描述：上传照片、读取 EXIF（时间/设备/GPS）；查看详情；列表分页/排序
- 验收：支持 JPG/PNG；EXIF 解析成功率≥90%；分页/排序可用

### R3 影视记录（Must）
- 描述：手动新增/搜索 TMDB 并创建；详情/列表；状态/评分/标签
- 依赖：TMDB API Key；配额缓存
- 验收：TMDB 搜索可用；创建成功；状态/评分可保存

### R4 音乐记录（Must）
- 描述：手动新增/搜索 Last.fm 并创建；详情/列表；标签
- 依赖：Last.fm API Key
- 验收：搜索可用；创建成功；标签可保存

### R6 自动标签（照片）（Must）
- 描述：调用免费 AI（Hugging Face/Gemini）生成 3-5 个标签；可回填到记录
- 依赖：免费 API 配额；缓存与降级策略
- 验收：成功率≥90%（有结果）；失败可重试/手动输入

### R7 自动标签（影视/音乐）（Should）
- 描述：基于影视/音乐信息生成 3-5 个标签；可编辑
- 依赖：免费 AI；文本 prompt 与缓存
- 验收：有可用标签；失败可手动补充

### R9 时间线/列表回顾（Must）
- 描述：按时间/类型/标签过滤；时间线/列表视图
- 验收：过滤准确；时间排序正确；性能在 MVP 数据量下可接受

### R8 基础统计卡片（Should）
- 描述：记录数量、按时间段的计数（周/月），按类型占比
- 验收：统计口径一致；刷新或定时计算；结果正确

### R10 权限/角色（Must）
- 描述：用户/管理员角色；管理员可管理数据；用户仅管理自己数据
- 验收：越权校验有效；接口鉴权生效

### R11 日志与监控（Must）
- 描述：接口访问日志、错误日志；基础健康检查；可选简易告警
- 验收：关键接口有日志；异常可追踪；健康检查返回 200

## 7. 需求依赖
- 外部 API：TMDB、Last.fm、Hugging Face/Gemini（免费优先），OpenAI（备选）
- 账号体系：JWT/Session，简单 RBAC
- 存储：对象存储（本地/OSS/MinIO），数据库 MySQL
- 缓存：Redis（API 结果/标签缓存）
- 前端：需支持搜索/筛选/上传/展示

## 8. 需求冲突与解决策略
- 成本 vs 体验：默认使用免费 AI，失败时允许用户手动；可后台开关付费 AI
- 配额 vs 覆盖：做缓存与降级；提供手动补录
- 进度 vs 范围：严格控制 MVP（Must），Should 作为弹性，Could/Won’t 延后

## 9. 约束与假设
- 假设：免费 API 在配额内可用；用户网络环境可访问公共 API
- 约束：付费 AI 默认关闭；图片大小与格式限制；单账号存储配额（占位数值待定）

## 10. 非功能需求概要（MVP 目标）
- 性能：P95 < 800ms @低并发；后续迭代 <500ms
- 可用性：SLA 99.5%（单区单活），允许短时维护窗口
- 安全：HTTPS；鉴权/越权校验；基础速率限制；敏感配置不落库
- 隐私：图片与位置数据仅用户可见；提供数据导出/删除能力（设计占位）
- 监控与日志：接口日志、错误日志；健康检查；基础告警（可选）

## 11. 需求可追溯矩阵（摘取关键项）
| 需求编号 | 业务目标/指标 | 依赖 | 验收方式 |
| --- | --- | --- | --- |
| R2/R6 | 提升记录效率/完成率 | 上传、AI 标签 | 用例+成功率统计 |
| R3/R4 | 影视/音乐记录能力 | TMDB/Last.fm | 用例+接口联调 |
| R8/R9 | 回顾与基础统计 | 数据汇总/查询 | 用例+数据核对 |
| R10 | 账户与权限安全 | 鉴权/RBAC | 用例+安全测试 |

## 12. 验收标准（示例）
- 功能：Must 需求用例通过率 100%；Should 需求 ≥90%
- 性能：核心接口 P95 < 800ms（MVP 数据量）；无严重阻塞
- 稳定性：核心接口错误率 < 0.5%
- 安全：登录/鉴权/越权用例全通过
- AI：自动标签成功率（返回可用标签）≥90%；失败有兜底提示

## 13. 风险与对策
- 配额/稳定性风险：多数据源/多 AI 备选，缓存与降级
- 成本风险：默认关闭付费 AI，限额与开关
- 合规风险：遵守第三方条款，最小化个人数据收集，支持删除/导出
- 进度风险：Must/Should 分层，里程碑内先交付 Must

## 14. 变更管理
- 变更提交：记录变更原因、影响范围、优先级调整
- 评审：PM/Tech/QA 评审通过后更新文档与追溯矩阵
- 版本：按 vX.Y.Z 记录，保留变更历史

## 15. 术语表（摘录）
- Must/Should/Could/Won’t：需求优先级分级
- TMDB/Last.fm：第三方影视/音乐数据源
- RBAC：基于角色的访问控制
- P95：95 分位响应时间


